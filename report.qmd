---
title: "Untitled"
format: html
---


```{r}
library(tidyverse)
library(lubridate)

dt <- read_csv("data.csv")

sleep <- dt |>
  filter(Type == "Sleep") |> 
  mutate(
    start = ymd_hms(Start),
    end = ymd_hms(End),
    duration = as.duration(hm(Duration))
  ) |>
  filter(start >= dmy("05/11/2025")) |> 
  select(start, end, duration) |> 
  arrange(start)
```

## Sono

- 06/11 - 12/11 (Belo Horizonte)
- 13/11 - 26/11 (Salvador)
- 27/11 - 01/12 (SÃ£o Paulo)
- 02/12 - 09/12 (Belo Horizonte)

```{r}
# Classify sleep as "night" or "day"
# Night: from 19:00 (7pm) of day N to 07:00 (7am) of day N+1
# Sleep starting before 7am is assigned to the previous night's date

sleep <- sleep |>
  mutate(
    start_hour = hour(start),
    sleep_type = case_when(
      start_hour >= 18 ~ "noite",  # Evening sleep
      start_hour < 6 ~ "noite",    # Early morning sleep
      TRUE ~ "dia"
    ),
    # Assign a "sleep_date" - for early morning, use previous day's date
    sleep_date = case_when(
      start_hour < 6 ~ date(start) - days(1),
      TRUE ~ date(start)
    )
  ) |>
  select(-start_hour)

sleep
```

```{r}
sleep |> filter(date(start) >= dmy("08/12/2025")) |> as.data.table()
```


```{r}
# Aggregate sleep statistics per day

sleep_summary <- sleep |>
  group_by(sleep_date, sleep_type) |>
  summarise(
    total_duration = duration(sum(duration)),
    sleep_blocks = n(),
    avg_block_duration = duration(mean(duration)),
    .groups = "drop"
  )

sleep |> filter(date(start) >= dmy("08/12/2025"))
sleep_summary |> filter(sleep_date >= dmy("08/12/2025"))

sleep_summary |> View()
```

